<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Consulta — Multa de Trânsito</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#22c55e; --accent2:#16a34a; --line:#1f2937; --warn:#fca5a5; --highlight:#fef08a; }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
    body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a 30%);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:820px}
    .card{width:100%;background:rgba(17,24,39,.88);backdrop-filter:blur(8px);border:1px solid var(--line);border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .hero{position:relative;height:220px;background:#0b1020;display:flex;align-items:flex-end;justify-content:space-between;overflow:hidden}
    .hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;object-position:center center;opacity:1}
    .hero .brand{position:relative;display:flex;align-items:center;gap:12px;padding:16px}
    .logo{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 6px 18px rgba(22,163,74,.25)}
    .content{padding:22px}
    h2{margin:8px 0 12px;font-size:20px}
    p{margin:0 0 16px;color:var(--muted);font-size:14px}
    label{display:block;margin:14px 0 6px;font-weight:600;font-size:13px}
    input[type="text"]{width:100%;padding:14px 12px;border-radius:10px;border:1px solid #374151;background:#0b1020;color:#e5e7eb;outline:none}
    input[type="text"]:focus{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,.2)}
    .row{display:flex;gap:10px;align-items:flex-start;margin-top:12px}
    .checkbox{accent-color:#60a5fa;margin-top:3px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0b1020;color:var(--text);text-decoration:none;cursor:pointer}
    .btn.block{width:100%}
    .btn.primary{background:linear-gradient(135deg,var(--accent2),var(--accent));border:none;color:white;font-weight:700}
    .btn.pay{background:linear-gradient(135deg,#06b6d4,#0ea5e9);border:none;color:white;font-weight:700}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .footer{padding:16px 22px;border-top:1px solid var(--line);font-size:12px;color:#6b7280;display:flex;gap:8px;flex-wrap:wrap;background:#0d1324}
    .link{color:#93c5fd;cursor:pointer;text-decoration:underline}
    .screen{display:none}
    .screen.active{display:block}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#052e1a;color:#a7f3d0;border:1px solid #14532d;font-size:12px;margin-bottom:12px}
    .pill{display:flex;align-items:center;gap:12px;padding:14px;border-radius:12px;background:#0b1020;border:1px solid var(--line);margin:10px 0}
    .value{font-size:26px;font-weight:800;color:var(--highlight)}
    .warn{color:var(--warn)}
    .actions{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap}
    .cpf{font-family:ui-monospace, Menlo, Consolas, monospace;color:#cbd5e1}
    .note{font-size:12px;color:#94a3b8;margin-top:10px}
    .grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
    .field{background:#0b1020;border:1px solid var(--line);border-radius:10px;padding:12px}
    .field label{font-size:12px;color:#9ca3af;margin:0 0 4px 0}
    .field div{font-size:14px;color:#e5e7eb}
    @media (min-width: 560px){ .grid{grid-template-columns:1fr 1fr} }
    @media (max-width: 520px){ .hero{height:180px} }
    .modal{width:100%;max-width:720px;background:#0b1020;border:1px solid var(--line);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .modal h3{margin:0 0 12px 0}
  </style>
</head>
<body>
  <div class="app">
    <main class="card">
      <header class="hero">
        <img id="heroImg" src="" alt="Imagem de destaque" />
        <div class="brand"><div class="logo"></div></div>
      </header>

      <section class="content">
        <!-- Tela 1: Formulário -->
        <section id="screen-form" class="screen active">
          <p>Digite seu CPF para verificar pendência de multa de trânsito.</p>
          <form id="form">
            <label for="cpf">CPF</label>
            <input id="cpf" name="cpf" type="text" placeholder="000.000.000-00" maxlength="14" required />
            <div class="row">
              <input class="checkbox" id="lgpd" type="checkbox" required />
              <label for="lgpd" style="font-weight:400;margin:0">
                Autorizo o uso dos meus dados para fins de consulta e contato, conforme a
                <span id="openPrivacy" class="link">Política de Privacidade</span>.
              </label>
            </div>
            <button id="submit" class="btn primary block" type="submit" disabled>Consultar</button>
          </form>
        </section>

        <!-- Tela 2: Resultado -->
        <section id="screen-result" class="screen">
          <span class="badge">Consulta concluída</span>
          <h2>Resultado</h2>

          <p>CPF consultado: <span id="cpfOut" class="cpf"></span></p>

          <div class="grid">
            <div class="field">
              <label>Nome</label>
              <div id="nomeOut">-</div>
            </div>
            <div class="field">
              <label>Data de Nascimento</label>
              <div id="nascimentoOut">-</div>
            </div>
            <div class="field" style="grid-column: 1 / -1;">
              <label>Nome da Mãe</label>
              <div id="maeOut">-</div>
            </div>
          </div>

          <div class="pill" style="margin-top:14px">
            <div>
              <div>Multa de trânsito encontrada</div>
              <div class="value">R$ 89,99</div>
            </div>
          </div>

          <p class="warn">Atenção: o não pagamento pode resultar em restrições, incluindo suspensão do direito de dirigir e possível negativação do CPF.</p>

          <div class="actions">
            <a class="btn pay" href="https://checkout.sempreativo.site/VCCL1O8SBJ8M" target="_blank" rel="noopener">Pagar agora</a>
            <span id="back" class="link" style="align-self:center;margin-left:auto">Nova consulta</span>
          </div>

          <div class="note">Informação indicativa. Para confirmação oficial, valide nos sistemas apropriados.</div>
        </section>
      </section>

      <footer class="footer">
        <span id="openPrivacy2" class="link">Política de Privacidade</span> |
        <span id="openTerms" class="link">Termos de Uso</span>
      </footer>
    </main>
  </div>

  <!-- Modal: Política de Privacidade -->
  <div id="privacyModal" class="modal-backdrop" aria-hidden="true" style="display:none;align-items:center;justify-content:center;padding:20px;background:rgba(0,0,0,.55);position:fixed;inset:0;">
    <div class="modal">
      <h3>Política de Privacidade</h3>
      <p>
        Esta Política descreve o tratamento de dados pessoais coletados neste site. Coletamos: CPF e confirmação de consentimento.
        Finalidade: exibir a consulta indicativa e, se solicitado, entrar em contato. Base legal: consentimento do titular (LGPD).
        Armazenamento: podemos reter CPF e timestamp do consentimento para registro/atendimento. Compartilhamento: apenas com provedores
        de tecnologia estritamente necessários. Direitos do titular: acesso, correção, revogação do consentimento.
      </p>
      <p>Segurança: medidas técnicas e organizacionais razoáveis. Este site exibe informação indicativa e orienta validação oficial.</p>
      <button class="btn close" id="closePrivacy">Fechar</button>
    </div>
  </div>

  <!-- Modal: Termos de Uso -->
  <div id="termsModal" class="modal-backdrop" aria-hidden="true" style="display:none;align-items:center;justify-content:center;padding:20px;background:rgba(0,0,0,.55);position:fixed;inset:0;">
    <div class="modal">
      <h3>Termos de Uso</h3>
      <p>As informações são indicativas e não substituem validação em sistemas oficiais. Você é responsável por fornecer dados verdadeiros.</p>
      <p>Uso indevido de dados de terceiros é proibido. Podemos alterar estes Termos a qualquer tempo.</p>
      <button class="btn close" id="closeTerms">Fechar</button>
    </div>
  </div>

  <script>
    // Config
    const HERO_IMAGE_URL = 'https://meucreditoagora.com/wp-content/uploads/2023/06/servicosdaserasaexperian.jpeg';
    const PAY_URL = 'https://checkout.sempreativo.site/VCCL1O8SBJ8M';

    // Imagem
    const heroImg = document.getElementById('heroImg');
    heroImg.src = HERO_IMAGE_URL;
    heroImg.onerror = () => { heroImg.style.display = 'none'; };

    // Elementos
    const cpfInput = document.getElementById('cpf');
    const lgpd = document.getElementById('lgpd');
    const submitBtn = document.getElementById('submit');
    const screenForm = document.getElementById('screen-form');
    const screenResult = document.getElementById('screen-result');
    const cpfOut = document.getElementById('cpfOut');
    const backLink = document.getElementById('back');
    const nomeOut = document.getElementById('nomeOut');
    const nascimentoOut = document.getElementById('nascimentoOut');
    const maeOut = document.getElementById('maeOut');

    // Máscara e validação
    function maskCPF(v){
      return v.replace(/\D/g,'')
              .replace(/(\d{3})(\d)/,'$1.$2')
              .replace(/(\d{3})(\d)/,'$1.$2')
              .replace(/(\d{3})(\d{1,2})$/,'$1-$2')
              .slice(0,14);
    }
    function isValidCPF(cpf) {
      cpf = cpf.replace(/\D/g, '');
      if (!cpf || cpf.length !== 11) return false;
      if (/^(\d)\1+$/.test(cpf)) return false;
      let sum = 0, rest;
      for (let i=1;i<=9;i++) sum += parseInt(cpf.substring(i-1,i))*(11-i);
      rest = (sum*10)%11; if (rest===10||rest===11) rest=0;
      if (rest !== parseInt(cpf.substring(9,10))) return false;
      sum = 0;
      for (let i=1;i<=10;i++) sum += parseInt(cpf.substring(i-1,i))*(12-i);
      rest = (sum*10)%11; if (rest===10||rest===11) rest=0;
      return rest === parseInt(cpf.substring(10,11));
    }
    function validate(){
      const clean = cpfInput.value.replace(/\D/g,'');
      submitBtn.disabled = !(clean.length === 11 && isValidCPF(clean) && lgpd.checked);
    }
    cpfInput.addEventListener('input', e => { e.target.value = maskCPF(e.target.value); validate(); });
    lgpd.addEventListener('change', validate);

    // Submit
    document.getElementById('form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const cpf = cpfInput.value.replace(/\D/g,'');

      // UI
      screenForm.classList.remove('active');
      screenResult.classList.add('active');
      const cpfFmt = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4");
      cpfOut.textContent = cpfFmt;
      nomeOut.textContent = 'Carregando...';
      nascimentoOut.textContent = 'Carregando...';
      maeOut.textContent = 'Carregando...';

      try {
        console.log('Enviando CPF:', cpf);
        const resp = await fetch('https://SEU-BACKEND.onrender.com/api/consultarCpf', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ cpf })
        });
        console.log('Status:', resp.status);

        if (!resp.ok) {
          let txt = await resp.text().catch(()=> '');
          console.error('Resposta de erro:', txt);
          preencherErro();
          return;
        }

        const data = await resp.json();
        console.log('Resposta:', data);
        preencherCampos(data);
      } catch (err) {
        console.error('Falha no fetch:', err);
        preencherErro();
      }

      document.querySelector('.btn.pay').href = PAY_URL;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Preenchimento
    function preencherCampos(data){
      const nome = data?.NOME || data?.nome || '-';
      const nascISO = data?.NASC || data?.nascimento || null;
      const mae = data?.NOME_MAE || data?.mae || '-';

      nomeOut.textContent = nome || '—';
      nascimentoOut.textContent = formatDateISO(nascISO) || '—';
      maeOut.textContent = mae || '—';
    }
    function formatDateISO(s){
      if (!s) return null;
      const d = new Date(s);
      if (isNaN(d.getTime())) return s;
      const dd = String(d.getUTCDate()).padStart(2,'0');
      const mm = String(d.getUTCMonth()+1).padStart(2,'0');
      const yyyy = d.getUTCFullYear();
      return `${dd}/${mm}/${yyyy}`;
    }
    function preencherErro(){
      nomeOut.textContent = 'Não disponível';
      nascimentoOut.textContent = 'Não disponível';
      maeOut.textContent = 'Não disponível';
    }

    // Voltar
    document.getElementById('back').addEventListener('click', ()=>{
      screenResult.classList.remove('active');
      screenForm.classList.add('active');
      cpfInput.focus();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Modais
    const privacyModal = document.getElementById('privacyModal');
    const termsModal = document.getElementById('termsModal');
    function openModal(m){ m.style.display = 'flex'; m.setAttribute('aria-hidden','false'); }
    function closeModal(m){ m.style.display = 'none'; m.setAttribute('aria-hidden','true'); }
    document.getElementById('openPrivacy').onclick = ()=>openModal(privacyModal);
    document.getElementById('openPrivacy2').onclick = ()=>openModal(privacyModal);
    document.getElementById('closePrivacy').onclick = ()=>closeModal(privacyModal);
    document.getElementById('openTerms').onclick = ()=>openModal(termsModal);
    document.getElementById('closeTerms').onclick = ()=>closeModal(termsModal);
    [privacyModal, termsModal].forEach(m => m.addEventListener('click', (e)=>{ if(e.target === m) closeModal(m); }));

    // Inicial
    validate();
  </script>
</body>
</html>